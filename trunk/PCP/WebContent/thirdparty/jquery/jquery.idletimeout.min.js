(function(b,c){var a={init:function(f,h,e){var d=this,g;this.warning=g=b(f);this.resume=b(h);this.options=e;this.countdownOpen=false;this.failedRequests=e.failedRequests;this._startTimer();this.title=document.title;b.data(g[0],"idletimeout",this);b.idleTimer(e.idleAfter*1000);b(document).bind("idle.idleTimer",function(){if(b.data(document,"idleTimer")==="idle"&&!d.countdownOpen){d._stopTimer();d.countdownOpen=true;d._idle()}});this.resume.bind("click",function(i){i.preventDefault();c.clearInterval(d.countdown);d.countdownOpen=false;d._startTimer();d._keepAlive(false);e.onResume.call(d.warning)})},_idle:function(){var e=this,f=this.options,g=this.warning[0],d=f.warningLength;f.onIdle.call(g);f.onCountdown.call(g,d);this.countdown=c.setInterval(function(){if(--d===0){window.clearInterval(e.countdown);f.onTimeout.call(g)}else{f.onCountdown.call(g,d);document.title=f.titleMessage.replace("%s",d)+e.title}},1000)},_startTimer:function(){var d=this;this.timer=c.setTimeout(function(){d._keepAlive()},this.options.pollingInterval*1000)},_stopTimer:function(){this.failedRequests=this.options.failedRequests;c.clearTimeout(this.timer)},_keepAlive:function(f){var d=this,e=this.options;document.title=d.title;if(typeof f==="undefined"){f=true}if(!this.failedRequests){this._stopTimer();e.onAbort.call(this.warning[0]);return}b.ajax({timeout:e.AJAXTimeout,url:e.keepAliveURL,error:function(){d.failedRequests--},success:function(g){if(b.trim(g)!==e.serverResponseEquals){d.failedRequests--}},complete:function(){if(f){d._startTimer()}}})}};b.idleTimeout=function(e,f,d){a.init(e,f,b.extend(b.idleTimeout.options,d));return this};b.idleTimeout.options={warningLength:30,keepAliveURL:"",serverResponseEquals:"OK",idleAfter:600,pollingInterval:60,failedRequests:5,AJAXTimeout:250,titleMessage:"Warning: %s seconds until log out | ",onTimeout:b.noop,onIdle:b.noop,onCountdown:b.noop,onResume:b.noop,onAbort:b.noop}})(jQuery,window);