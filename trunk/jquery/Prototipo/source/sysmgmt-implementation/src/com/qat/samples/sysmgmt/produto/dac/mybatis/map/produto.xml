<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProdutoMap">


  <!-- Result maps describe the mapping between the columns returned
       from a query, and the class properties.  A result map isn't
       necessary if the columns (or aliases) match to the properties
       exactly. produtoid, codbarra, nome, marca, menu, submenu, trimenu, unimed,
            precoid, controleid, foto, supermercadoid-->
  <resultMap id="ProdutoResult" type="Produto">
    <result property="id" column="produtoid"/>
    <result property="codBarra" column="codbarra"/>
    <result property="nome" column="nome"/>
    <result property="descricao" column="descricao"/>
    <result property="foto" column="foto"/>
    <association property="marca" column="marca" javaType="Cadastro" select="fetchMarcaByCode" />
    <association property="menu" column="menu" javaType="Cadastro" select="fetchMenuByCode" />
    <association property="unimed" column="unimed" javaType="Cadastro" select="fetchUniMedByCode" />
    <collection property="precos" column="produtoid" select="PrecoMap.fetchPrecoByProduto" />
    <collection property="acessos" column="produtoid" select="ControleAcessMap.fetchControleAcessByProduto" />
  </resultMap>

   <resultMap id="CadastroResult" type="Cadastro">
    <result property="id" column="cadastroid"/>
    <result property="tableTypeEnumValue" column="acao"/>
    <result property="nome" column="nome"/>
    <result property="descricao" column="descricao"/>
    <result property="controleid" column="controleid"/>
    <collection property="acessos" column="cadastroid" select="ControleAcessMap.fetchControleAcessByCadastro" />
    <collection property="produtos" column="cadastroid" select="fetchProdutosByMarca" />
  </resultMap>

  <resultMap id="CadastroResults" type="Cadastro">
    <result property="id" column="cadastroid"/>
    <result property="tableTypeEnumValue" column="acao"/>
    <result property="nome" column="nome"/>
    <result property="descricao" column="descricao"/>
    <result property="controleid" column="controleid"/>
    <collection property="acessos" column="cadastroid" select="ControleAcessMap.fetchControleAcessByProduto" />
  </resultMap>





  <sql id="allCadastroColumns">
		cadastroid, acao, nome,descricao
  </sql>

  <sql id="allCadastroColumnsWithQualifier">
		p.cadastroid, p.acao, p.nome,p.descricao
  </sql>

<sql id="allProdutoColumns">
		PRODUTOID, CODBARRA, NOME, MARCA, MENU,DESCRICAO SUBMENU, TRIMENU, UNIMED,PRECOID, CONTROLEID, FOTO, SUPERMERCADOID
  </sql>

  <sql id="allProdutoColumnsWithQualifier">
		p.PRODUTOID, p.CODBARRA, p.NOME,p.DESCRICAO, p.MARCA, p.MENU, p.SUBMENU, p.TRIMENU, p.UNIMED,
            p.PRECOID, p.CONTROLEID, p.FOTO, p.SUPERMERCADOID
  </sql>

    <select id="fetchMarcaByCode" parameterType="int" resultMap="CadastroResults">
	    SELECT
	    <include refid="allCadastroColumns" />
	    FROM cadastro where acao = 3 and cadastroid = #{id}  ORDER BY cadastroid ASC
    </select>

    <select id="fetchProdutosByMenu" parameterType="int" resultMap="ProdutoResult">
	    SELECT
	    <include refid="allProdutoColumns" />
	    FROM produto where menu = #{id}  ORDER BY PRODUTOID ASC
    </select>

     <select id="fetchProdutosByMarca" parameterType="int" resultMap="ProdutoResult">
	    SELECT
	    <include refid="allProdutoColumns" />
	    FROM produto where marca = #{id} or
	    				   MENU = #{id} or
	    				   UNIMED = #{id}
	    				 ORDER BY PRODUTOID ASC
    </select>

     <select id="fetchProdutosBySubMenu" parameterType="int" resultMap="ProdutoResult">
	    SELECT
	    <include refid="allProdutoColumns" />
	    FROM produto where submenu = #{id}  ORDER BY PRODUTOID ASC
    </select>

    <select id="fetchProdutosByTriMenu" parameterType="int" resultMap="ProdutoResult">
	    SELECT
	    <include refid="allProdutoColumns" />
	    FROM produto where trimenu = #{id}  ORDER BY PRODUTOID ASC
    </select>

    <select id="fetchProdutosByUnimed" parameterType="int" resultMap="ProdutoResult">
	    SELECT
	    <include refid="allProdutoColumns" />
	    FROM produto where unimed = #{id}  ORDER BY PRODUTOID ASC
    </select>

    <select id="fetchMenuByCode" parameterType="int" resultMap="CadastroResults">
	    SELECT
	    <include refid="allCadastroColumns" />
	    FROM cadastro where acao in(4,5,6) and cadastroid = #{id}  ORDER BY cadastroid ASC
    </select>

    <select id="fetchSubMenuByCode" parameterType="int" resultMap="CadastroResult">
	    SELECT
	    <include refid="allCadastroColumns" />
	    FROM cadastro where acao = 3 and cadastroid = #{id}  ORDER BY cadastroid ASC
    </select>

    <select id="fetchTriMenuByCode" parameterType="int" resultMap="CadastroResult">
	    SELECT
	    <include refid="allCadastroColumns" />
	    FROM cadastro where acao = 4 and cadastroid = #{id}  ORDER BY cadastroid ASC
    </select>

    <select id="fetchUniMedByCode" parameterType="int" resultMap="CadastroResults">
	    SELECT
	    <include refid="allCadastroColumns" />
	    FROM cadastro where acao = 7 and cadastroid = #{id}  ORDER BY cadastroid ASC
    </select>

  <select id="fetchAllCadastro" parameterType="Cadastro" resultMap="CadastroResult">
    SELECT
    <include refid="allCadastroColumns" />
    FROM cadastro where acao = #{tableTypeEnumValue}} ORDER BY cadastroid ASC
  </select>

   <select id="fetchAllProduto" parameterType="Produto" resultMap="ProdutoResult">
    SELECT
    <include refid="allProdutoColumns" />
    FROM produto  ORDER BY ID ASC
  </select>

  <select id="fetchAllCadastroPagedBatch" parameterType="Cadastro" resultMap="CadastroResult">

		SELECT <include refid="allCadastroColumns" />
   		  FROM cadastro where acao =  #{tableTypeEnumValue} ORDER BY cadastroid ASC
		  OFFSET ( #{_page} * #{_pagesize} )
		  LIMIT #{_pagesize}
  </select>

   <select id="fetchAllProdutoPagedBatch" parameterType="Produto" resultMap="ProdutoResult">

		SELECT <include refid="allProdutoColumns" />
   		  FROM produto  ORDER BY produtoid ASC
		  OFFSET ( #{_page} * #{_pagesize} )
		  LIMIT #{_pagesize}
  </select>

  <select id="fetchCadastroRowCount" parameterType="CadastroInquiryRequest" resultType="Integer">
		SELECT COUNT(*) AS RECORD_COUNT FROM CADASTRO WHERE ACAO =  #{cadastro.tableTypeEnumValue}
  </select>

  <select id="fetchProdutoRowCount" parameterType="ProdutoInquiryRequest" resultType="Integer">
		SELECT COUNT(*) AS RECORD_COUNT FROM PRODUTO
  </select>

  <select id="fetchAllCadastrosRequest" parameterType="CadastroInquiryRequest" resultMap="CadastroResult">
		SELECT <include refid="allCadastroColumns" />
   		  FROM cadastro where acao =  #{cadastro.tableTypeEnumValue} ORDER BY cadastroid ASC
		  OFFSET ( #{startPage} * #{pageSize} )
		  LIMIT #{pageSize}
  </select>

  <select id="fetchAllProdutosRequest" parameterType="ProdutoInquiryRequest" resultMap="ProdutoResult">
		SELECT <include refid="allProdutoColumns" />
   		  FROM PRODUTO ORDER BY produtoid ASC
		  OFFSET ( #{startPage} * #{pageSize} )
		  LIMIT #{pageSize}
  </select>

  <select id="fetchAllProdutos" parameterType="ProdutoInquiryRequest" resultMap="ProdutoResult">
		SELECT <include refid="allProdutoColumns" />
   		  FROM PRODUTO
   		  ORDER BY produtoid ASC
  </select>

   <select id="fetchAllProdutosSupermercado" parameterType="ProdutoInquiryRequest" resultMap="ProdutoResult">
		SELECT <include refid="allProdutoColumns" />
   		  FROM PRODUTO
   		  <where>
			<if test="produto.marca.id != null">and marca = #{produto.marca.id}</if>
			<if test="produto.menu.id != null">and menu = #{produto.menu.id}</if>
			<if test="produto.codBarra != null">and codBarra = #{produto.codBarra}</if>
			<if test="produto.nome != null">AND nome = #{produto.nome}</if>
			<if test="produto.unimed.id != null">AND unimed = #{produto.unimed.id}</if>
		</where>
   		  ORDER BY produtoid ASC
  </select>

 <select id="fetchAllCadastros" parameterType="Cadastro" resultMap="CadastroResult">
		SELECT <include refid="allCadastroColumns" />
   		  FROM Cadastro
		<where>
			<if test="tableTypeEnumValue != 1">acao = #{tableTypeEnumValue}</if>
			<if test="descricao != null">and descricao = #{descricao}</if>
			<if test="nome != null">AND nome = #{nome}</if>

		</where>
   		  ORDER BY cadastroid ASC
  </select>

  <select id="fetchAllCadastrosTotal" parameterType="Cadastro" resultMap="CadastroResult">
		SELECT <include refid="allCadastroColumns" />
   		  FROM Cadastro
   		  ORDER BY cadastroid ASC
  </select>

  <select id="fetchCadastroById" parameterType="Cadastro" resultMap="CadastroResult">
    SELECT
   <include refid="allCadastroColumns" />
     FROM cadastro where acao =  #{tableTypeEnumValue} AND cadastroid = #{id}
  </select>

   <select id="fetchProdutoById" parameterType="Produto" resultMap="ProdutoResult">
    SELECT
   <include refid="allProdutoColumns" />
     FROM PRODUTO where produtoid = #{id}
  </select>
  <select id="fetchProdutoByIdInt" parameterType="int" resultMap="ProdutoResult">
    SELECT
   <include refid="allProdutoColumns" />
     FROM PRODUTO where produtoid = #{id}
  </select>


  <select id="insertCadastro" parameterType="Cadastro" resultType="int" statementType="CALLABLE">
        { call ins_cadastro( #{descricao}, #{nome},#{tableTypeEnumValue},#{userId} ) }

  </select>

  <select id="insertProduto" parameterType="HashMap" resultType="int" statementType="CALLABLE">
        { call ins_produto( #{produtoid} , #{codbarra} , #{nome} , #{marca} , #{menu}, #{unimed} , #{foto} ,#{descricao} ,  #{usuarioid} ) }
  </select>


  <select id="updateCadastro" parameterType="Cadastro" resultType="int" statementType="CALLABLE">
     { call upd_cadastro(  #{id},#{descricao}, #{nome},#{tableTypeEnumValue},#{userId} ) }
  </select>

  <select id="updateProduto" parameterType="Produto" resultType="int" statementType="CALLABLE">
	{ call upd_produto( #{produtoid} , #{codbarra} , #{nome} , #{marca} , #{menu}, #{unimed} , #{foto} ,#{descricao} ,  #{usuarioid} ) }
  </select>

  <select id="deleteCadastroById" parameterType="Cadastro" resultType="int" statementType="CALLABLE">
        { call del_cadastro( #{id} , #{tableTypeEnumValue}, #{userId} ) }

  </select>

  <delete id="deleteAllCadastros">
	DELETE FROM cADASTRO
  </delete>

   <select id="deleteProdutoById" parameterType="Produto" resultType="int" statementType="CALLABLE">
   { call del_produto( #{id} , #{userId} ) }
  </select>

  <delete id="deleteAllProdutos">
	DELETE FROM PRODUTO
  </delete>
</mapper>